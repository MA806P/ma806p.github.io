<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    iOS 动画 丨
    

    Peng&#39;s blog
  </title>

  
  <link rel="shortcut icon" href="/images/favicon.ico">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Peng&#39;s blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">iOS 动画</div>
  <div class="post-meta">
    <div class="date">2018 January 21st</div>
    <div class="tags">
      
      <div class="tag-item">OC</div>
      
      <div class="tag-item">UI</div>
      
      <div class="tag-item">动画</div>
      
    </div>
  </div>
  

  <main class="post-content"><h4 id="Core-Animation简介"><a href="#Core-Animation简介" class="headerlink" title="Core Animation简介"></a>Core Animation简介</h4><p>Core Animation，中文翻译为核心动画，它是一组非常强大的动画处理API，使用它能做出非常炫丽的动画效果，而且往往是事半功倍。也就是说，使用少量的代码就可以实现非常强大的功能。<br>Core Animation可以用在Mac OS X和iOS平台。<br>Core Animation的动画执行过程都是在后台操作的，不会阻塞主线程。<br>要注意的是，Core Animation是直接作用在CALayer上的，并非UIView。有关CALayer可参看之前的博客：<a target="_blank" rel="noopener" href="http://yupeng.fun/2017/12/20/viewlayer/">CALayer</a>。</p>
<p><img src="/images/2018/animation-1.png"></p>
<p>Core Animation 每次添加动画时 QuartzCore 会打包其参数，然后通过进程间通信的方式传递给一个名为 backboard 的后台进程。然后该进程通过 OpenGL 渲染和处理 layer 的层级以及 layer 上的动画。最重要的一点就是该进程完全独立于你的应用，应用只会拿到动画开始和结束的回调（CAAnimationDelegate），不负责动画的渲染（显式动画除外）。也就是主线程和 CoreAnimation 不会互相影响，也就是即使主线程阻塞了，CoreAnimation 依旧在执行。</p>
<br>

<h4 id="CAAnimation"><a href="#CAAnimation" class="headerlink" title="CAAnimation"></a>CAAnimation</h4><p><img src="/images/2018/animation-2.png"></p>
<h6 id="1、CAAnimation的常用属性："><a href="#1、CAAnimation的常用属性：" class="headerlink" title="1、CAAnimation的常用属性："></a>1、CAAnimation的常用属性：</h6><ul>
<li><p>duration：动画的持续时间</p>
</li>
<li><p>repeatCount：动画的重复次数，(INFINITY，HUGE_VALF，CGFLOAT_MAX)</p>
</li>
<li><p>speed：表示当前对象的时间流速，如果speed是2，duration是3，那么经过1.5秒动画就播放完成了。</p>
</li>
<li><p>removedOnCompletion ：保持动画执行后的状态。默认值为YES，动画执行完毕后，动画会自动从CALayer上移除，CALayer又会回到原来的状态</p>
</li>
<li><p>fillMode：播放结束后的状态<br>kCAFillModeForwards：保持结束时状态<br>kCAFillModeBackwards：保持开始时状态<br>kCAFillModeBoth：保持两者<br>kCAFillModeRemoved：移除</p>
</li>
<li><p>timingFunction：控制动画运行的节奏<br>timingFunction可设置的值有：<br>kCAMediaTimingFunctionLinear：线性匀速<br>kCAMediaTimingFunctionEaseIn：缓慢进入，然后加速离开<br>kCAMediaTimingFunctionEaseOut：快速进入，然后减速到达<br>kCAMediaTimingFunctionEaseInEaseOut：渐进渐出，缓慢的进入，中间加速，然后减速的到达</p>
</li>
<li><p>delegate：动画代理，用来监听动画的执行过程</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 动画开始执行的时候触发这个方法</span><br><span class="line">- (void)animationDidStart:(CAAnimation *)anim;</span><br><span class="line">// 动画执行完毕的时候触发这个方法</span><br><span class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag;</span><br></pre></td></tr></table></figure>

<h5 id="2、-CALayer-addAnimation"><a href="#2、-CALayer-addAnimation" class="headerlink" title="2、 CALayer  addAnimation"></a>2、 CALayer  addAnimation</h5><p>在上篇 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/094111c88b44">UIView, CALayer</a> 中提到，当你给一个 CALayer 添加动画的时候，实并没有改变这个 layer 的实际属性。取而代之的，系统会创建一个原始 layer 的拷贝，原始 layer 为 Model Layer ，复制的 layer 则被称为 Presentation Layer 。 Presentation Layer 的属性会随着动画的进度实时改变，而 Model Layer 中对应的属性则并不会改变。也就是默认情况下系统会动画执行完后，自动移除 CAAnimation，移除之后系统就会自动销毁这个 layer 的 Presentation Layer ，只留下 Model Layer ，Model Layer 的属性其实并没有变化，一瞬间回到了动画的初始状态。要解决这种情况，你需要先把 removedOnCompletion 设 置 为 NO ， 然 后 设 置 fillMode 为 kCAFillModeForwards 保持结束时状态。</p>
<br>

<h4 id="CAPropertyAnimation"><a href="#CAPropertyAnimation" class="headerlink" title="CAPropertyAnimation"></a>CAPropertyAnimation</h4><p>CAPropertyAnimation是CAAnimation的子类，但是不能直接使用，要想创建动画对象，应该使用它的两个子类：CABasicAnimation和CAKeyframeAnimation<br>它有个NSString类型的keyPath属性，你可以指定CALayer的某个属性名为keyPath，并且对CALayer的这个属性的值进行修改，达到相应的动画效果。比如，指定@”position”为keyPath，就会修改CALayer的position属性的值，以达到平移的动画效果<br>因此，初始化好CAPropertyAnimation的子类对象后，必须先设置keyPath，搞清楚要修改的是CALayer的哪个属性，执行的是怎样的动画。<br>CALayer的那些属性改变支持动画效果，查看CALayer属性对应的注释，有animatable，就是支持动画的。<br><img src="/images/2018/animation-3.png"></p>
<br>

<h5 id="CABasicAnimation"><a href="#CABasicAnimation" class="headerlink" title="CABasicAnimation"></a>CABasicAnimation</h5><p>CABasicAnimation是CAPropertyAnimation的子类，使用它可以实现一些基本的动画效果，它可以让CALayer的某个属性从某个值渐变到另一个值。下面就用CABasicAnimation实现几个简单的动画。</p>
<ul>
<li>平移动画</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//KeyPath:@&quot;position&quot;：说明要修改的是CALayer的position属性，执行平移动画</span><br><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">anim.duration = 1.5;  // 动画持续1.5s</span><br><span class="line"></span><br><span class="line">// position属性值从(50, 80)渐变到(300, 350)</span><br><span class="line">//不是直接使用CGPoint这种结构体类型，而是要先包装成NSValue对象后再使用。</span><br><span class="line">anim.fromValue = [NSValue valueWithCGPoint:CGPointMake(50, 80)];</span><br><span class="line">anim.toValue = [NSValue valueWithCGPoint:CGPointMake(300, 350)];</span><br><span class="line">//如果将toValue换成byValue，代表CALayer从位置(50, 80)开始向右移动300、向下移动350，也就是移动到位置(350, 430)</span><br><span class="line"></span><br><span class="line">// 设置动画的代理</span><br><span class="line">anim.delegate = self;</span><br><span class="line"></span><br><span class="line">// 保持动画执行后的状态。默认值为YES，动画执行完毕后，动画会自动从CALayer上移除，CALayer又会回到原来的状态</span><br><span class="line">anim.removedOnCompletion = NO;</span><br><span class="line">anim.fillMode = kCAFillModeForwards;</span><br><span class="line"></span><br><span class="line">// 添加动画对象到图层上</span><br><span class="line">[view.layer addAnimation:anim forKey:@&quot;translate&quot;];</span><br><span class="line">//给动画对象起个名称，以后可以调用CALayer的removeAnimationForKey:方法根据动画名称停止相应的动画</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//设置动画的代理，可以监听动画的执行过程</span><br><span class="line">// 动画开始</span><br><span class="line">- (void)animationDidStart:(CAAnimation *)anim &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//动画结束</span><br><span class="line">- (void)animationDidStop:(CAAnimation *)anim finished:(BOOL)flag &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>平移另一种方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//平移</span><br><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;transform&quot;];</span><br><span class="line">anim.duration = 1;</span><br><span class="line">CATransform3D form = CATransform3DMakeTranslation(350, 350, 0);</span><br><span class="line">anim.toValue = [NSValue valueWithCATransform3D:form];</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>缩放动画</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;bounds&quot;];</span><br><span class="line">anim.duration = 2;</span><br><span class="line">anim.toValue = [NSValue valueWithCGRect:CGRectMake(0, 0, 30, 30)];</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br><span class="line">//layer会从原来的尺寸变为30x30</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;transform&quot;];</span><br><span class="line">anim.duration = 2; </span><br><span class="line">// CALayer的宽度从0.5倍变为2倍、高度从0.5倍变为1.5倍</span><br><span class="line">anim.fromValue = [NSValue valueWithCATransform3D:CATransform3DMakeScale(0.5, 0.5, 1)];</span><br><span class="line">anim.toValue  = [NSValue valueWithCATransform3D:CATransform3DMakeScale(2, 1.5, 1)];</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;transform.scale&quot;];</span><br><span class="line">anim.toValue = @0.5;</span><br><span class="line">anim.duration = 1.0;</span><br><span class="line">anim.repeatCount = 10;</span><br><span class="line">anim.fillMode = kCAFillModeForwards;</span><br><span class="line">anim.removedOnCompletion = NO;</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br></pre></td></tr></table></figure>

<br>

<ul>
<li>旋转动画</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *anim = [CABasicAnimation animationWithKeyPath:@&quot;transform&quot;];</span><br><span class="line">anim.duration = 1.5;</span><br><span class="line">// 绕着(0, 0, 1)这个向量轴顺时针旋转45°</span><br><span class="line">anim.toValue = [NSValue valueWithCATransform3D:CATransform3DMakeRotation(M_PI_4, 0, 0, 1)];</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br></pre></td></tr></table></figure>
<br>

<h5 id="CAKeyframeAnimation"><a href="#CAKeyframeAnimation" class="headerlink" title="CAKeyframeAnimation"></a>CAKeyframeAnimation</h5><p>CABasicAnimation和CAKeyframeAnimation都是继承自CAPropertyAnimation。CAKeyframeAnimation是核心动画里面的帧动画，它提供了按照指定的一串值进行动画，与CABasicAnimation的不同点在于他可以指定多个状态，不局限于始末状态。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CAKeyframeAnimation * animation = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">animation.values = @[[NSValue valueWithCGPoint:CGPointMake(0, 0)],[NSValue valueWithCGPoint:CGPointMake(100, 100)],[NSValue valueWithCGPoint:CGPointMake(0, 200)]];</span><br><span class="line">animation.duration = 2;</span><br><span class="line">animation.removedOnCompletion = NO;</span><br><span class="line">animation.fillMode = kCAFillModeForwards;</span><br><span class="line">[view.layer addAnimation:animation forKey:nil];</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CAKeyframeAnimation *ani = [CAKeyframeAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">anim.path = [UIBezierPath bezierPathWithOvalInRect:CGRectMake(40, 40, 100, 300)].CGPath;</span><br><span class="line">anim.duration = 2.0;</span><br><span class="line">anim.fillMode = kCAFillModeForwards;</span><br><span class="line">anim.repeatCount = 10;</span><br><span class="line">anim.removedOnCompletion = NO;</span><br><span class="line">//anim.calculationMode = kCAAnimationCubicPaced;</span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018/animation-4.gif"></p>
<p>CAKeyframeAnimation的属性解释：</p>
<ul>
<li><p>values： 是许多值组成的数组用来进行动画的。这个属性比较特别，只有在path属性值为nil的时候才有作用</p>
</li>
<li><p>path:路径,可以指定一个路径,让动画沿着这个指定的路径执行。</p>
</li>
<li><p>cacluationMode：计算模式，其主要针对的是每一帧的内容为一个座标点的情况,也就是对anchorPoint 和 position 进行的动画，当在平面座标系中有多个离散的点的时候，可以是离散的,也可以直线相连后进行插值计算,也可以使用圆滑的曲线将他们相连后进行插值计算.<br>kCAAnimationLinear calculationMode的默认值,r自定义控制动画的时间（线性）可以设置keyTimes,表示当关键帧为座标点的时候,关键帧之间直接直线相连进行插值计算;<br>kCAAnimationDiscrete 离散的,就是不进行插值计算,所有关键帧直接逐个进行显示;<br>kCAAnimationPaced 节奏动画自动计算动画的运动时间,使得动画均匀进行,而不是按keyTimes设置的或者按关键帧平分时间,此时keyTimes和timingFunctions无效;<br>kCAAnimationCubic 对关键帧为座标点的关键帧进行圆滑曲线相连后插值计算,对于曲线的形状还可以通过tensionValues,continuityValues,biasValues来进行调整自定义，这里的主要目的是使得运行的轨迹变得圆滑,曲线动画需要设置timingFunctions<br>kCAAnimationCubicPaced 看这个名字就知道和kCAAnimationCubic有一定联系,其实就是在kCAAnimationCubic的基础上使得动画运行变得均匀,就是系统时间内运动的距离相同,此时keyTimes以及timingFunctions也是无效的.</p>
</li>
<li><p>keyTimes:一个包含若干NSNumber对象值的数组，用来区分动画的分割时机。值得注意的是,这些NSNumber对象的浮点型值在0.0~1.0之间。里面的值后一个比前一个要大或者相等。最好的结果是这个数组中的值和values里面的值或者path控制的值对应，否则可能会出现不了你想要的结果。属性为应用在每一关键帧指定应用到每一个关键帧上的计时器。该属性只在calculationMode属性被设置为kCAAnimationLinear，kCAAnimaitonDiscrete，kCAAnimationCubic时被使用。它不使用在节奏动画中。keyTimes定义了应用在每一关键帧的时间点。所有中间值的定时由定时函数控制，定时函数允许你对各个部分应用缓入或缓出曲线定时。如果你不指定任何定时函数，动画将会是线性的</p>
</li>
<li><p>rotationMode : 旋转样式<br>kCAAnimationRotateAuto 根据路径自动旋转<br>kCAAnimationRotateAutoReverse 根据路径自动翻转</p>
</li>
</ul>
<br>

<h5 id="CAAnimationGroup"><a href="#CAAnimationGroup" class="headerlink" title="CAAnimationGroup"></a>CAAnimationGroup</h5><p>CAAnimationGroup 动画组，是 CAAnimation 的子类，可以保存一组动画对象，将 CAAnimationGroup 对象加入层后，组中所有动画对象可以同时并发运行。<br>animations ：用来保存一组动画对象的 NSArray。默认情况下，一组动画对象是同时运行的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">CABasicAnimation *anim1 = [CABasicAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">anim1.fromValue = [NSValue valueWithCGPoint:CGPointMake(15, 15)];</span><br><span class="line">anim1.toValue = [NSValue valueWithCGPoint:CGPointMake(280, 15)];</span><br><span class="line">anim1.fillMode = kCAFillModeForwards;</span><br><span class="line">anim1.removedOnCompletion = NO;</span><br><span class="line">anim1.duration = 2.0;</span><br><span class="line"></span><br><span class="line">CAKeyframeAnimation *anim2 = [CAKeyframeAnimation animationWithKeyPath:@&quot;transform.rotation&quot;];</span><br><span class="line">anim2.values = @[@0, @(M_PI_4), @(M_PI_4 * 2.0), @(M_PI_4 * 3.0), @(M_PI_4 * 4.0)];</span><br><span class="line">anim2.fillMode = kCAFillModeForwards;</span><br><span class="line">anim2.removedOnCompletion = NO;</span><br><span class="line">anim2.calculationMode = kCAAnimationCubicPaced;</span><br><span class="line">anim2.duration = 0.5;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CAAnimationGroup *group = [CAAnimationGroup animation];</span><br><span class="line">group.duration = 2.0;</span><br><span class="line">group.animations = @[anim1, anim2];</span><br><span class="line">group.fillMode = kCAFillModeForwards;</span><br><span class="line">group.removedOnCompletion = NO;</span><br><span class="line"></span><br><span class="line">[view.layer addAnimation:group forKey:nil];</span><br></pre></td></tr></table></figure>
<p><img src="/images/2018/animation-5.gif"></p>
<br>



<h5 id="CATransition"><a href="#CATransition" class="headerlink" title="CATransition"></a>CATransition</h5><p>CATransition 转场动画，是 CAAnimation 的子类，用于做转场动画，能够为层提供移出屏幕和移入屏幕的动画效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//单个视图的情况，转场切换颜色、图片等</span><br><span class="line">CATransition *tran = [CATransition animation];</span><br><span class="line">tran.duration = 2.0;</span><br><span class="line">tran.type = @&quot;flip&quot;;</span><br><span class="line">tran.subtype = kCATransitionFromRight;</span><br><span class="line"></span><br><span class="line">[self.v1.layer addAnimation:tran forKey:nil];</span><br><span class="line">self.v1.backgroundColor = [UIColor cyanColor];</span><br></pre></td></tr></table></figure>


<p><img src="/images/2018/animation-70.gif"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">//两个视图的情况，转场切换显示的子视图</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    UIView *v = [[UIView alloc] initWithFrame:CGRectMake(40, 40, 100, 100)];</span><br><span class="line">    [self.view addSubview:v];</span><br><span class="line">    self.v = v;</span><br><span class="line">    </span><br><span class="line">    UIView *v1 = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 100)];</span><br><span class="line">    v1.backgroundColor = [UIColor brownColor];</span><br><span class="line">    [v addSubview:v1];</span><br><span class="line">    self.v1 = v1;</span><br><span class="line">    </span><br><span class="line">    UIView *v2 = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 100, 100)];</span><br><span class="line">    v2.backgroundColor = [UIColor grayColor];</span><br><span class="line">    [v addSubview:v2];</span><br><span class="line">    self.v2 = v2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</span><br><span class="line">    CATransition *tran = [CATransition animation];</span><br><span class="line">    tran.duration = 2.0;</span><br><span class="line">    tran.type = @&quot;pageCurl&quot;;</span><br><span class="line">    tran.subtype = kCATransitionFromBottom;</span><br><span class="line">    </span><br><span class="line">    [self.v.layer addAnimation:tran forKey:nil];</span><br><span class="line">    [self.v exchangeSubviewAtIndex:1 withSubviewAtIndex:0];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018/animation-7.gif"></p>
<ul>
<li><p>type：转场动画的类型  </p>
<p>基本型：<br>  kCATransitionFade      交叉淡化过渡<br>  kCATransitionPush      新视图把旧视图推出去<br>  kCATransitionMoveIn    新视图移到旧视图上面<br>kCATransitionReveal    将旧视图移开,显示下面的新视图<br>  用字符串表示的类型：<br>  fade   push   moveIn   reveal   和系统自带的四种一样<br>  pageCurl               向上翻页效果<br>  pageUnCurl             向下翻页效果<br>  rippleEffect           水滴效果<br>  suckEffect             收缩效果，如一块布被抽走<br>  cube                   立方体翻滚效果<br>  alignedCube            立方体翻滚效果<br>  flip                   翻转效果<br>  alignedFlip            翻转效果<br>  oglFlip                翻转效果<br>  rotate                 旋转<br>  cameraIrisHollowOpen   相机镜头打开效果<br>  cameraIrisHollowClose  相机镜头关闭效果<br>  cameraIris             相机镜头打开关闭效果</p>
</li>
<li><p>subtype：转场动画将要去往的方向  </p>
<p>kCATransitionFromRight<br>  kCATransitionFromLeft<br>  kCATransitionFromTop<br>  kCATransitionFromBottom  </p>
</li>
<li><p>startProgress、endProgress： 开始和结束的位置进度，数值介于[0,1]之间，结束值一定是大于开始值的</p>
</li>
</ul>
<br> 

<h5 id="CASpringAnimation"><a href="#CASpringAnimation" class="headerlink" title="CASpringAnimation"></a>CASpringAnimation</h5><p>iOS9之后引入的动画类，在以前使用facebook的pop来做这种弹簧效果，它继承于CABaseAnimation，用于制作弹簧动画。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CASpringAnimation *anim = [CASpringAnimation animationWithKeyPath:@&quot;position&quot;];</span><br><span class="line">anim.duration = 1;</span><br><span class="line">anim.toValue = [NSValue valueWithCGPoint:CGPointMake(220, 220)];</span><br><span class="line">anim.fillMode = kCAFillModeForwards;</span><br><span class="line">anim.removedOnCompletion = NO;</span><br><span class="line">//anim.mass = 1;</span><br><span class="line">//anim.stiffness = 100;</span><br><span class="line"></span><br><span class="line">[view.layer addAnimation:anim forKey:nil];</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018/animation-6.gif"></p>
<ul>
<li><p>mass:质量，影响图层运动时的弹簧惯性，质量越大，弹簧拉伸和压缩的幅度越大，动画的速度变慢，并且波动幅度变大</p>
</li>
<li><p>stiffness:刚度系数(劲度系数&#x2F;弹性系数)，刚度系数越大，形变产生的力就越大，运动越快</p>
</li>
<li><p>damping:阻尼系数，阻止弹簧伸缩的系数，阻尼系数越大，停止越快，来回摆动越不明显</p>
</li>
<li><p>initialVelocity:初始速率，动画视图的初始速度大小速率为正数时，速度方向与运动方向一致，速率为负数时，速度方向与运动方向相反如果</p>
</li>
<li><p>settlingDuration:结算时间 返回弹簧动画到停止时的估算时间，根据当前的动画参数估算通常弹簧动画的时间使用结算时间比较准确</p>
</li>
</ul>
<br>



<h4 id="UIView-Animation"><a href="#UIView-Animation" class="headerlink" title="UIView Animation"></a>UIView Animation</h4><p>UIView 也提供了更简洁的接口，方便我们来添加动画。其实 UIView 动画背后也是使用 Core Animation 添加到对应的图层上，所产生的动画效果。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:(NSTimeInterval)//动画时间</span><br><span class="line">                          delay:(NSTimeInterval)//动画延迟时间</span><br><span class="line">                        options:(UIViewAnimationOptions)//动画过渡效果</span><br><span class="line">                     animations:^&#123;</span><br><span class="line">        //执行动画</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        //动画结束回调</span><br><span class="line">    &#125;]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//UIViewAnimationOptions 动画过度效果</span><br><span class="line">UIViewAnimationOptionLayoutSubviews            //进行动画时布局子控件</span><br><span class="line">  UIViewAnimationOptionAllowUserInteraction      //进行动画时允许用户交互</span><br><span class="line">  UIViewAnimationOptionBeginFromCurrentState     //从当前状态开始动画</span><br><span class="line">  UIViewAnimationOptionRepeat                    //无限重复执行动画</span><br><span class="line">  UIViewAnimationOptionAutoreverse               //执行动画回路</span><br><span class="line">  UIViewAnimationOptionOverrideInheritedDuration //忽略嵌套动画的执行时间设置</span><br><span class="line">  UIViewAnimationOptionOverrideInheritedCurve    //忽略嵌套动画的曲线设置</span><br><span class="line">  UIViewAnimationOptionAllowAnimatedContent      //转场：进行动画时重绘视图</span><br><span class="line">  UIViewAnimationOptionShowHideTransitionViews   //转场：移除（添加和移除图层的）动画效果</span><br><span class="line">  UIViewAnimationOptionOverrideInheritedOptions  //不继承父动画设置</span><br><span class="line">  </span><br><span class="line">  UIViewAnimationOptionCurveEaseInOut            //时间曲线，慢进慢出（默认值）</span><br><span class="line">  UIViewAnimationOptionCurveEaseIn               //时间曲线，慢进</span><br><span class="line">  UIViewAnimationOptionCurveEaseOut              //时间曲线，慢出</span><br><span class="line">  UIViewAnimationOptionCurveLinear               //时间曲线，匀速</span><br><span class="line">  </span><br><span class="line">  UIViewAnimationOptionTransitionNone            //转场，不使用动画</span><br><span class="line">  UIViewAnimationOptionTransitionFlipFromLeft    //转场，从左向右旋转翻页</span><br><span class="line">  UIViewAnimationOptionTransitionFlipFromRight   //转场，从右向左旋转翻页</span><br><span class="line">  UIViewAnimationOptionTransitionCurlUp          //转场，下往上卷曲翻页</span><br><span class="line">  UIViewAnimationOptionTransitionCurlDown        //转场，从上往下卷曲翻页</span><br><span class="line">  UIViewAnimationOptionTransitionCrossDissolve   //转场，交叉消失和出现</span><br><span class="line">  UIViewAnimationOptionTransitionFlipFromTop     //转场，从上向下旋转翻页</span><br><span class="line">  UIViewAnimationOptionTransitionFlipFromBottom  //转场，从下向上旋转翻页</span><br></pre></td></tr></table></figure>



<p>Spring 弹性动画</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:2.0</span><br><span class="line">                   delay:0</span><br><span class="line">  usingSpringWithDamping:0.2 //震动效果，范围0~1，数值越小震动效果越明显</span><br><span class="line">   initialSpringVelocity:10 //初始速度，数值越大初始速度越快</span><br><span class="line">                 options:UIViewAnimationOptionCurveEaseInOut</span><br><span class="line">              animations:^&#123;</span><br><span class="line">                 //执行的动画</span><br><span class="line"> &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">                 //动画执行提交后的操作</span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018/animation-8.gif" alt="Spring"></p>
<p>关键帧动画</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//关键帧动画，支持属性关键帧，不支持路径关键帧</span><br><span class="line"> [UIView animateKeyframesWithDuration:(NSTimeInterval)</span><br><span class="line">                            delay:(NSTimeInterval)</span><br><span class="line">                          options:(UIViewKeyframeAnimationOptions)//动画的过渡效果</span><br><span class="line">                       animations:^&#123;</span><br><span class="line">                     //执行的关键帧动画</span><br><span class="line"> &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">                     //动画执行提交后的操作</span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>



<p>转场动画</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//转场动画</span><br><span class="line">[UIView transitionFromView:v1  //从 v1 转为 v2</span><br><span class="line">                    toView:v2</span><br><span class="line">                    duration:2.0 </span><br><span class="line">                    options:UIViewAnimationOptionTransitionFlipFromTop  //转场动画的过渡效果</span><br><span class="line">                    completion:^(BOOL finished) &#123;</span><br><span class="line">        </span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>

<p><img src="/images/2018/animation-9.gif" alt="Spring"></p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514">Core Animation Programming Guide</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/QianChia/p/6359714.html">http://www.cnblogs.com/QianChia/p/6359714.html</a><br><a target="_blank" rel="noopener" href="http://www.cocoachina.com/ios/20170124/18617.html">http://www.cocoachina.com/ios/20170124/18617.html</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/92a0661a21c6">https://www.jianshu.com/p/92a0661a21c6</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/kenshincui/p/3972100.html">http://www.cnblogs.com/kenshincui/p/3972100.html</a></p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2026 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>