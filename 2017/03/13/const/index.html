<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    OC中#define、const的使用 丨
    

    Peng&#39;s blog
  </title>

  
  <link rel="shortcut icon" href="/images/favicon.ico">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- 字体 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 8.1.1"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">Peng&#39;s blog</a>
    <ul class="nav">
      
      <li><a href="/archives">archives</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">OC中#define、const的使用</div>
  <div class="post-meta">
    <div class="date">2017 March 13th</div>
    <div class="tags">
      
      <div class="tag-item">OC</div>
      
    </div>
  </div>
  

  <main class="post-content"><h3 id="一、多用常量，少用-define预处理指令"><a href="#一、多用常量，少用-define预处理指令" class="headerlink" title="一、多用常量，少用#define预处理指令"></a>一、多用常量，少用#define预处理指令</h3><p>const关键字，它限定一个变量不允许被改变。使用const在一定程度上可以提高程序的安全性和可靠性。便于进行类型检查，使编译器对处理内容有更多了解，消除了一些隐患。<br>const 推出的初始目的，正是为了取代#define预处理指令，消除它的缺点，同时继承它的优点。使用#define预处理指令，只是在预处理器里进行文本替换，这样定义出来的常量不含类型信息，编译器只是会在编译前据此执行查找和替换，即时有人重新定义此常量值，编译器也不会警告，这将导致应用内常量值不一致。</p>
<blockquote>
<p>(1) 编译器处理方式不同<br>　　define宏是在预处理阶段展开。<br>　　const常量是编译运行阶段使用。<br>(2) 类型和安全检查不同<br>　　define宏没有类型，不做任何类型检查，仅仅是展开。<br>　　const常量有具体的类型，在编译阶段会执行类型检查。<br>(3) 存储方式不同<br>　　define宏仅仅是展开，有多少地方使用，就展开多少次，不会分配内存。（宏定义不分配内存，变量定义分配内存。）如果是字符串类型，取的时候只需要给前面地址，如果是整形、浮点型会有多份拷贝，但这些数写在指令中。占的只是代码段而已，大量用宏会导致二进制文件变大<br>　　const常量会在内存中分配(可以是堆中也可以是栈中)。共享一块内存空间，就算项目中N处用到，也不会分配N块内存空间。<br>(4)const 可以节省空间，避免不必要的内存分配。</p>
</blockquote>
<h3 id="二、const的使用"><a href="#二、const的使用" class="headerlink" title="二、const的使用"></a>二、const的使用</h3><p>1、注意常量名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static const NSTimeInterval kAninationDuration = 0.3</span><br></pre></td></tr></table></figure>
<p>若常量局限于某“编译单元”（translation unit，也就是“实现文件”implementation file）之内，则在前面加上字母k；<br>若常量在类之外可见，则通常以类名为前缀。</p>
<p>2、变量一定要同时用static和const来声明。如果试图修改有const修饰的变量，那么编译器就会报错。而static修饰符则意味着该变量仅在定义变量的编译单元可见。编译器每收到一个编译单元，就会输出一份“目标文件”（object file）。那么如果声明上述变量不加static修饰，则编译器会为他创建一个“外部符号”（external symbol）。此时若是另一个编译单元也声明了同名变量，那么编译器就会报错。</p>
<p>实际上，如果变量既声明为static又声明为const，那么编译器根本不会创建符号，而是会像#define预处理指令一样，把所有遇到的变量都替换成常值。不过这种定义方法的常量带有类型信息。</p>
<p>3、公开常量</p>
<p>那么有时候如果需要公开常量的时候。那么此类常量需要放在“全局符号表”（global symbol table）中，以便可以在定义该常量的编译单元之外使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// In the header file </span><br><span class="line">extern NSString *const XYZStringConstant;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//In the implementation file</span><br><span class="line">NSString *const XYZStringConstant = @&quot;VALUE&quot;;</span><br></pre></td></tr></table></figure>
<p>这个变量声明在头文件，且在实现文件“定义”。注意const修饰符在常量类型中的位置。常量定义应该从右至左阅读，所以，XYZStringConstant 就是“一个常量，而这个常量是指针，指向 NSString 对象”，这与需求相符。</p>
<p>FOUNDATION_EXPORT</p>
<p>在 OC 中系统库头文件或第三方库时，经常可以看到 FOUNDATION_EXPORT，作用与 extern 相同，可置于变量&#x2F;常量或者函数前，以表示变量&#x2F;常量或者函数的定义在别的文件中，提示编译器遇到此变量或函数时，在其它模块中寻找其定义。实际上，我们在 NSObjCRuntime.h 头文件中看一下 FOUNDATION_EXPORT的定义，就可以看到它实际上就是 extern 的一个宏定义，只不过是同时兼容了 C 与 C++。所以，如果在程序中用到了 C 与 C++ 混编，那么建议使用FOUNDATION_EXPORT来声明全局变量&#x2F;常量或函数。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//NSObjCRuntime.h</span><br><span class="line">#if defined(__cplusplus)</span><br><span class="line">#define FOUNDATION_EXTERN extern &quot;C&quot;</span><br><span class="line">#else</span><br><span class="line">#define FOUNDATION_EXTERN extern</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#define FOUNDATION_EXPORT FOUNDATION_EXTERN</span><br><span class="line">#define FOUNDATION_IMPORT FOUNDATION_EXTERN</span><br></pre></td></tr></table></figure>

<p>使用，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;ViewController.h&quot;</span><br><span class="line">#import &quot;Student.h&quot;</span><br><span class="line"></span><br><span class="line">NSString *const XYZStringConstant = @&quot;VALUE&quot;;</span><br><span class="line">NSString * XYZStringValue = @&quot;VALUE&quot;;</span><br><span class="line"></span><br><span class="line">@implementation ViewController</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    XYZStringValue = @&quot;123&quot;;</span><br><span class="line">    </span><br><span class="line">    Student *s = [[Student alloc] init];</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;Student.h&quot;</span><br><span class="line"></span><br><span class="line">FOUNDATION_EXPORT NSString *const XYZStringConstant;</span><br><span class="line">FOUNDATION_EXPORT NSString * XYZStringValue;</span><br><span class="line"></span><br><span class="line">@implementation Student</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        NSLog(@&quot; student - %@ %@&quot;, XYZStringConstant, XYZStringValue);</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上例所示，在 ViewController 中定义了常量，然后再别的文件中用 FOUNDATION_EXPORT 声明使用。</p>
<p>4、注意const修饰符在常量类型中的位置。<br>const只修饰它右边的内容，被const修饰的内容都是常量<br><img src="/images/2017/const-1.png"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/25829244/">《Effective Objective-C 2.0》</a><br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/f83335e036b5">iOS 宏(define)与常量(const)的正确使用</a></p>
</main>

</article>


<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright © 2026 typo</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>